<%- include('../partials/header', { title: 'Llista d\'incidències' }) %>

<h1>Llista d'incidències</h1>

<form method="GET" action="/incidencies" class="mb-4">
  <div class="input-group">
    <label class="input-group-text" for="tecnic_id">Filtrar per tècnic:</label>
    <select name="tecnic_id" id="tecnic_id" class="form-select" onchange="this.form.submit()">
      <option value="">-- Tots els tècnics --</option>
      <% tecnics.forEach(t => { %>
        <option value="<%= t.id_tecnic %>" <%= tecnic_id === t.id_tecnic ? 'selected' : '' %>>
          <%= t.nom %>
        </option>
      <% }) %>
    </select>
  </div>
</form>

<table class="table table-striped table-dark table-hover">
  <thead>
    <tr>
      <th>Id  </th> 
      <th>Descripció</th>
      <th>Estat</th>
      <th>Prioritat</th>
      <th>Departament</th>
      <th>Tècnic</th>
      
      <th>Accions</th>
    </tr>
  </thead>
  <tbody>
    <% incidencies.forEach(inc => { %>
      <tr>
        <td><%= inc.id %></td>
        <td><%= inc.descripcio %></td>
        <td><%= inc.estat ? inc.estat : 'No asignado' %></td>
        <td><%= inc.prioridad ? inc.prioridad : 'No asignado' %></td>
        <td><%= inc.DEPARTAMENT ? inc.DEPARTAMENT.nom : 'No asignado' %></td>
        <td><%= inc.TECNIC ? inc.TECNIC.nom : 'No asignado' %></td>
        <td>
          <a href="/incidencies/<%= inc.id %>/actuacions" class="btn btn-info btn-sm">Veure</a>
          <a href="/incidencies/<%= inc.id %>/edit" class="btn btn-warning btn-sm">Editar</a>
          <a href="/incidencies/<%= inc.id %>/delete" class="btn btn-danger btn-sm">Eliminar</a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<%- include('../partials/footer') %>