<%- include('../partials/header', { title: 'Llista d\'incidències', bodyClass: 'bg-crema' }) %>


  <h1 class="titulo">LLISTA D'INCIDÈNCIES</h1>

  <link rel="stylesheet" href="/static/css/btn.css">

  <form method="GET" action="/incidencies" class="mb-4">
    <div class="input-group">
      <label class="input-group-text" for="tecnic_id">Filtrar per tècnic:</label>
      <select name="tecnic_id" id="tecnic_id" class="form-select" onchange="this.form.submit()">
        <option value="">-- Tots els tècnics --</option>
        <% tecnics.forEach(t=> { %>
          <option value="<%= t.id_tecnic %>" <%=tecnic_id===t.id_tecnic ? 'selected' : '' %>>
            <%= t.nom %>
          </option>
          <% }) %>
      </select>
    </div>
  </form>

  <table class="table table-striped table-dark table-hover">
    <thead>
      <tr>
        <th>Id </th>
        <th>Descripció</th>
        <th>Estat</th>
        <th>Prioritat</th>
        <th>Departament</th>
        <th>Tècnic</th>

        <th>Accions</th>
      </tr>
    </thead>
    <tbody>
      <% incidencies.forEach(inc=> { %>
        <tr>
          <td>
            <%= inc.id %>
          </td>
          <td>
            <%= inc.descripcio %>
          </td>
          <td>
            <%= inc.estat ? inc.estat : 'No asignado' %>
          </td>
          <td>
            <%= inc.prioridad ? inc.prioridad : 'No asignado' %>
          </td>
          <td><%= inc.departament ? inc.departament.nom : 'No asignado' %></td>
          <td><%= inc.tecnic ? inc.tecnic.nom : 'No asignado' %></td>

          <td>
            <div class="button-container">
              <!-- Veure -->
              <a href="/incidencies/<%= inc.id %>/actuacions" title="Veure" class="button">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                  <g id="SVGRepo_iconCarrier">
                    <path opacity="0.15" fill-rule="evenodd" clip-rule="evenodd"
                      d="M12 5C5.63636 5 2 12 2 12C2 12 5.63636 19 12 19C18.3636 19 22 12 22 12C22 12 18.3636 5 12 5ZM15 12C15 13.6569 13.6569 15 12 15C10.3431 15 9 13.6569 9 12C9 10.3431 10.3431 9 12 9C13.6569 9 15 10.3431 15 12Z"
                      fill="#000000"></path>
                    <path
                      d="M12 5C5.63636 5 2 12 2 12C2 12 5.63636 19 12 19C18.3636 19 22 12 22 12C22 12 18.3636 5 12 5Z"
                      stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path
                      d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z"
                      stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                  </g>
                </svg>
              </a>

              <!-- Editar -->
              <a href="/incidencies/<%= inc.id %>/edit" title="Editar" class="button">
                <svg viewBox="0 -0.5 21 21" version="1.1" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000">
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                  <g id="SVGRepo_iconCarrier">
                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                      <g id="Dribbble-Light-Preview" transform="translate(-419.000000, -359.000000)" fill="#000000">
                        <g id="icons" transform="translate(56.000000, 160.000000)">
                          <path
                            d="M384,209.210475 L384,219 L363,219 L363,199.42095 L373.5,199.42095 L373.5,201.378855 L365.1,201.378855 L365.1,217.042095 L381.9,217.042095 L381.9,209.210475 L384,209.210475 Z M370.35,209.51395 L378.7731,201.64513 L380.4048,203.643172 L371.88195,212.147332 L370.35,212.147332 L370.35,209.51395 Z M368.25,214.105237 L372.7818,214.105237 L383.18415,203.64513 L378.8298,199 L368.25,208.687714 L368.25,214.105237 Z"
                            id="edit_cover-[#1481]">
                          </path>
                        </g>
                      </g>
                    </g>
                  </g>
                </svg>
              </a>

              <!-- Eliminar -->
              <a href="/incidencies/<%= inc.id %>/delete" title="Eliminar" class="button">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                  <g id="SVGRepo_iconCarrier">
                    <path d="M10 12V17" stroke="#000000" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round"></path>
                    <path d="M14 12V17" stroke="#000000" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round"></path>
                    <path d="M4 7H20" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    </path>
                    <path d="M6 10V18C6 19.6569 7.34315 21 9 21H15C16.6569 21 18 19.6569 18 18V10" stroke="#000000"
                      stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" stroke="#000000"
                      stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </g>
                </svg>
              </a>
            </div>
          </td>

        </tr>
        <% }) %>
    </tbody>
  </table>

  <%- include('../partials/footer') %>